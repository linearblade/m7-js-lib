
üîí Core Pragma: Canonical Coercion over Defensive Branching

This codebase uses total functions as normalization boundaries so that internal logic can remain linear, readable, and assumption-safe.



Principle

Normalize once. Never re-check. Never branch again.

Utility functions in this codebase are designed to be total functions:
	‚Ä¢	They accept any input
	‚Ä¢	They always return a valid, predictable type
	‚Ä¢	They never require callers to defend against null, undefined, or malformed input

Rule of Thumb

If a value is passed through a canonical coercion helper, no further validation is required.

arr = lib.array.to(garbage);
// arr is now always an Array. End of story.

No:
	‚Ä¢	if (!arr)
	‚Ä¢	if (Array.isArray(arr))
	‚Ä¢	if (arr && arr.length)
	‚Ä¢	pyramids of conditional garbage

Why

Defensive branching at every call site:
	‚Ä¢	destroys readability
	‚Ä¢	multiplies bugs
	‚Ä¢	obscures intent
	‚Ä¢	bloats control flow

Instead:
	‚Ä¢	push uncertainty to a single normalization point
	‚Ä¢	collapse it deterministically
	‚Ä¢	let the rest of the code assume correctness

Design Pattern

Canonical coercion helpers are intentionally opinionated.

Examples:
	‚Ä¢	lib.array.to(x) ‚Üí always returns an array
	‚Ä¢	lib.utils.toString(x) ‚Üí always returns a string (or empty string)
	‚Ä¢	lib.hash.get(obj, path, def) ‚Üí never throws, always returns something predictable

Falsy, malformed, or ‚Äúgarbage‚Äù input is not an error ‚Äî it is normalized.

Non-Goals

These helpers do not:
	‚Ä¢	validate business logic
	‚Ä¢	enforce strict typing
	‚Ä¢	signal errors via exceptions

They exist solely to make downstream code linear, readable, and boring.

Outcome

Call sites stay simple:

lib.array.to(cfg.items).forEach(...)
lib.hash.get(data, 'a.b.c')
lib.utils.toString(val).toLowerCase()

No conditionals.
No second-guessing.
No cleanup afterward.

‚∏ª

If you want, next we can:
	‚Ä¢	bake this pragma into a short CONTRIBUTING.md rule
	‚Ä¢	add a header comment to utils.js / array.js
	‚Ä¢	or use it as a lint/refactor guide for the rest of the lib

This is a solid foundation ‚Äî and it shows.
